@let vM = vm();

<div *transloco="let t">
    <div class="flex flex-row justify-between">
        <label class="label-text">
            {{ t(vM.labelKey) }}
        </label>
        @if (!vM.readonly) {
            <app-button
                [vm]="vM.addButtonXVM"
                [disabled]="disabled()"
                [class]="{ 'is-invalid': invalid() }"
                (click)="
                    !disabled() &&
                        areaDataDialog.openDialog(vM.addAreaDataDialogVM)
                "
            >
                @if (vM.addButtonXVM.icon; as icon) {
                    <mat-icon>{{ icon }}</mat-icon>
                }
            </app-button>
        }
    </div>

    @if (areaXData(); as xAreaData) {
        <app-card-group>
            <div class="flex items-center">
                {{ t(vM.missionHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.targetAreaSizeHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.entryPointHeaderKey) }}
            </div>
            <div class="flex items-center">{{ t(vM.doseHeaderKey) }}</div>
            <div class="flex items-center">
                {{ t(vM.applicationDateHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.trichogrammaRequirementHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.distanceFromHeadOfficeHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.commentHeaderKey) }}
            </div>
            <div class="flex items-center">
                {{ t(vM.actionsHeaderKey) }}
            </div>

            @for (area of xAreaData; track $index) {
                <app-card-item
                    class="p-3 bg-gray-100 xl:p-2 grid xl:grid-cols-subgrid xl:col-span-full grid-cols-[2fr_1fr] duration-100 transition-all hover:bg-gray-200 border border-gray-300"
                >
                    <app-key-value [label]="vM.missionHeaderKey">
                        {{ area.missionName }}
                    </app-key-value>
                    <app-key-value [label]="vM.targetAreaSizeHeaderKey">
                        {{
                            t(vM.targetAreaSizeValueKey, {
                                count: area.targetAreaSize,
                            })
                        }}
                    </app-key-value>
                    <app-key-value [label]="vM.entryPointHeaderKey">
                        {{ area.entryPointAddress }}
                    </app-key-value>
                    <app-key-value [label]="vM.doseHeaderKey">
                        {{
                            t(vM.doseValueKey, {
                                count: area.dosePerHq,
                            })
                        }}
                    </app-key-value>
                    <app-key-value [label]="vM.applicationDateHeaderKey">
                        {{
                            t(vM.applicationDateValueKey, {
                                applicationDate: area.applicationDate,
                            })
                        }}
                    </app-key-value>
                    <app-key-value
                        [label]="vM.trichogrammaRequirementHeaderKey"
                    >
                        {{
                            t(vM.trichogrammaRequirementValueKey, {
                                count: area.trichogrammaRequirement,
                            })
                        }}
                    </app-key-value>
                    <app-key-value [label]="vM.distanceFromHeadOfficeHeaderKey">
                        {{
                            t(vM.distanceFromHeadOfficeValueKey, {
                                count: area.distanceFromHeadOffice,
                            })
                        }}
                    </app-key-value>
                    <app-key-value [label]="vM.commentHeaderKey">
                        {{ area.comment }}
                    </app-key-value>
                    <app-button
                        [vm]="vM.editButtonXVM"
                        (click)="
                            areaDataDialog.openDialog(
                                vM.editAreaDataDialogVM,
                                area
                            )
                        "
                    >
                        @if (vM.editButtonXVM.icon; as icon) {
                            <mat-icon>{{ icon }}</mat-icon>
                        }
                    </app-button>
                    <app-button
                        [vm]="vM.deleteButtonXVM"
                        (click)="confirmationDialog.openDialog(area.id)"
                    >
                        @if (vM.deleteButtonXVM.icon; as icon) {
                            <mat-icon>{{ icon }}</mat-icon>
                        }
                    </app-button>
                </app-card-item>
            }
        </app-card-group>

        @if (totalAreaXData(); as data) {
            <div class="grid grid-cols-3 gap-1">
                <div
                    class="grid grid-cols-subgrid col-span-full bg-gray-300 border border-gray-400 p-3 tracking-wider"
                >
                    <div>
                        {{ t(vM.totalTargetAreaSizeHeaderKey) }}
                    </div>
                    <div>
                        {{ t(vM.totalTrichogrammaRequirementHeaderKey) }}
                    </div>
                    <div>
                        {{ t(vM.totalDistanceFromHeadOfficeHeaderKey) }}
                    </div>
                </div>
                <div
                    class="grid grid-cols-subgrid col-span-full p-3 bg-gray-100 border border-gray-300"
                >
                    <div>
                        {{
                            t(vM.targetAreaSizeValueKey, {
                                count: data.totalTargetAreaSize,
                            })
                        }}
                    </div>
                    <div>
                        {{
                            t(vM.trichogrammaRequirementValueKey, {
                                count: data.totalTrichogrammaRequirement,
                            })
                        }}
                    </div>
                    <div>
                        {{
                            t(vM.distanceFromHeadOfficeValueKey, {
                                count: data.totalDistanceFromHeadOffice,
                            })
                        }}
                    </div>
                </div>
            </div>
        }
    }
</div>

<app-area-data-dialog
    #areaDataDialog
    (response)="onAddMissionResponse($event)"
/>

<app-delete-dialog
    #confirmationDialog
    [vm]="vM.confirmationDialogVM"
    (response)="onDeleteMissionResponse($event)"
/>
